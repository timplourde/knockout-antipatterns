<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title></title>
    <script src="../lib/jquery-1.10.2.min.js"></script>
    <script src="../lib/knockout-3.0.0.js"></script>
    <script src="../lib/knockout.mapping-latest.js"></script>
    <style>
        h1 {
            color: red;
        }

        .child {
            margin-bottom: 1em;
        }
    </style>
</head>
<body>

    <div id="app">

        <h1 data-bind="visible: isDirty">DIRTY!</h1>

        <!-- ko with: person -->

            <div>
                Name: <input type="text" data-bind="value: name" />
            </div>
            <div>
                Age: <input type="number" min="1" max="100" data-bind="value: age" />
            </div>

            <h3>Children</h3>

            <!-- ko foreach: children -->
            <div class="child">
                <div>
                    Name: <input type="text" data-bind="value: name" />
                </div>
                <div>
                    Age: <input type="number" min="1" max="100" data-bind="value: age" />
                </div>
            </div>
            <!-- /ko -->

        <!-- /ko -->
    </div>

    <script>

        dirtyTracker = function(objectWithObservableStuff){
            var initialized = false;
            return ko.computed(function () {
                if (initialized) {
                    return true;
                }
                ko.toJS(objectWithObservableStuff);
                initialized = true;
                return false;
            })
        }

        function ViewModel() {
            var self = this;

            self.person = ko.mapping.fromJS({
                name: "Bill",
                age: 40,
                children: [
                    {
                        name: "Jane",
                        age: 6
                    },
                     {
                         name: "Joe",
                         age: 8
                     }
                ]
            });

            self.isDirty = dirtyTracker(self.person);
        }

        $(document).on("ready", function () {

            var vm = new ViewModel();
            ko.applyBindings(vm, $("#app")[0]);

        });
    </script>
</body>
</html>